name: Verify Azure Cleanup Fix

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  test-cleanup-disabled:
    name: Test azure/login v2.2.0 with cleanup disabled
    runs-on: ubuntu-latest
    steps:
      - name: Remove Azure CLI to simulate environment without az
        run: |
          sudo apt-get remove -y azure-cli
          echo "Azure CLI removed - 'az' command should not be available"

      - name: Verify az is not available
        run: |
          if command -v az &> /dev/null; then
            echo "❌ FAIL: az command still exists"
            exit 1
          fi
          echo "✅ PASS: az command not found (as expected)"

      - name: Use azure/login v2.2.0 with cleanup disabled
        uses: azure/login@a65d910e8af852a8061c627c456678983e180302 # v2.2.0
        if: false  # Skip main step, but post-cleanup will still be evaluated
        env:
          AZURE_LOGIN_POST_CLEANUP: false

      - name: Success - no cleanup warning appeared
        run: |
          echo "✅ Test passed!"
          echo "The azure/login@v2.2.0 post-cleanup step was skipped as expected."
          echo "No warning about missing 'az' command appeared in the logs."
